<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vocabulary Pro v2.2</title>
    <style>
        :root { --p: #00b894; --bg: #f2f2f7; --txt: #1c1c1e; --success: #34c759; --danger: #ff3b30; --secondary: #8e8e93; }
        
        /* Mobil uchun umumiy sozlamalar */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 10px;
            overflow-x: hidden;
        }
        
        .quiz-card { 
            background: white; 
            width: 100%; 
            max-width: 500px; 
            padding: 20px; 
            border-radius: 24px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.08); 
            display: flex; 
            flex-direction: column; 
            min-height: 550px; 
            position: relative;
        }
        
        /* Start Screen */
        #start-screen { text-align: center; margin: auto 0; }
        .mode-btn { 
            width: 100%; 
            padding: 18px; 
            margin: 10px 0; 
            border: none; 
            border-radius: 16px; 
            background: #eef2f3; 
            font-size: 17px; 
            font-weight: 700; 
            cursor: pointer; 
            color: var(--txt);
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .category-tag { background: #00b89415; padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 700; color: var(--p); text-transform: uppercase; }
        .counter { font-size: 13px; font-weight: 600; color: var(--secondary); }
        
        .progress-bar { width: 100%; height: 6px; background: #e5e5ea; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
        #progress { height: 100%; background: var(--p); width: 0%; transition: 0.4s ease; }

        .question-box { text-align: center; margin-bottom: 20px; }
        .mode-label { font-size: 10px; font-weight: 800; color: var(--secondary); letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .question-text { font-size: 24px; font-weight: 800; color: var(--txt); line-height: 1.2; }

        /* Variantlar - Eng muhim joyi */
        .options { 
            display: grid; 
            gap: 10px; 
            width: 100%; 
            position: relative;
            z-index: 99; /* Tugmalar doim eng ustida bo'lishi kerak */
        }
        .opt { 
            padding: 15px; 
            border: 2px solid #f2f2f7; 
            border-radius: 14px; 
            background: white; 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            color: var(--txt); 
            text-align: center;
            transition: background 0.1s;
        }
        .opt:active { background: #eef2f3; }
        
        .correct { background: var(--success) !important; color: white !important; border-color: var(--success) !important; }
        .wrong { background: var(--danger) !important; color: white !important; border-color: var(--danger) !important; }

        .footer { margin-top: auto; padding-top: 20px; z-index: 1; }
        .score-row { margin-bottom: 15px; font-weight: 700; font-size: 16px; }
        
        .btn-container { display: flex; gap: 10px; height: 50px; }
        .action-btn { flex: 1; border-radius: 12px; font-weight: 700; font-size: 14px; cursor: pointer; border: none; }
        
        #finish-btn { background: #fff; color: var(--danger); border: 2px solid var(--danger); }
        #next-btn { background: var(--txt); color: white; display: none; }
        .placeholder-btn { flex: 1; pointer-events: none; opacity: 0; }

        .result-box { text-align: center; margin: auto 0; }
        .result-pct { font-size: 50px; font-weight: 900; color: var(--p); }
    </style>
</head>
<body>

<div class="quiz-card">
    <div id="start-screen">
        <h1>Unit 1 Test</h1>
        <p style="color: #8e8e93; margin-bottom: 20px;">Rejimni tanlang</p>
        <button class="mode-btn" onclick="startQuiz('uz-en')">O'zbekcha ➔ Inglizcha</button>
        <button class="mode-btn" onclick="startQuiz('en-uz')">Inglizcha ➔ O'zbekcha</button>
    </div>

    <div id="quiz-area" style="display: none; height: 100%; flex-direction: column;">
        <div class="header">
            <span id="category" class="category-tag">...</span>
            <span id="counter" class="counter">0 / 0</span>
        </div>
        <div class="progress-bar"><div id="progress"></div></div>
        
        <div class="question-box">
            <div id="mode-label" class="mode-label">TOPING:</div>
            <div id="q-text" class="question-text">...</div>
        </div>
        
        <div id="options" class="options"></div>
        
        <div class="footer">
            <div class="score-row" id="score-info">Ball: 0</div>
            <div class="btn-container">
                <button id="finish-btn" class="action-btn" onclick="showResults()">Tugatish</button>
                <button id="next-btn" class="action-btn" onclick="nextQuestion()">Keyingisi &rarr;</button>
                <div id="btn-placeholder" class="placeholder-btn"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // Dictionary (To'liq)
    const dictionary = [
        {en: "beat", uz: "yutmoq, mag'lub qilmoq", c: "Topic Vocabulary"}, {en: "board game", uz: "taxtali o'yin", c: "Topic Vocabulary"},
        {en: "captain", uz: "kapitan", c: "Topic Vocabulary"}, {en: "challenge", uz: "da'vat etmoq", c: "Topic Vocabulary"},
        {en: "champion", uz: "chempion", c: "Topic Vocabulary"}, {en: "cheat", uz: "aldamoq", c: "Topic Vocabulary"},
        {en: "classical music", uz: "klassik musiqa", c: "Topic Vocabulary"}, {en: "club", uz: "klub", c: "Topic Vocabulary"},
        {en: "coach", uz: "murabbiy", c: "Topic Vocabulary"}, {en: "competition", uz: "musobaqa", c: "Topic Vocabulary"},
        {en: "concert", uz: "konsert", c: "Topic Vocabulary"}, {en: "defeat", uz: "mag'lub qilmoq", c: "Topic Vocabulary"},
        {en: "entertaining", uz: "ko'ngilochar", c: "Topic Vocabulary"}, {en: "folk music", uz: "xalq qo'shig'i", c: "Topic Vocabulary"},
        {en: "group", uz: "guruh", c: "Topic Vocabulary"}, {en: "gym", uz: "zal", c: "Topic Vocabulary"},
        {en: "have fun", uz: "yayramoq", c: "Topic Vocabulary"}, {en: "interest", uz: "qiziqmoq, qiziqish", c: "Topic Vocabulary"},
        {en: "member", uz: "a'zo", c: "Topic Vocabulary"}, {en: "opponent", uz: "raqib", c: "Topic Vocabulary"},
        {en: "organise", uz: "tashkillashtirmoq", c: "Topic Vocabulary"}, {en: "pleasure", uz: "rohat", c: "Topic Vocabulary"},
        {en: "referee", uz: "sudya, hakam", c: "Topic Vocabulary"}, {en: "rhythm", uz: "ritm", c: "Topic Vocabulary"},
        {en: "risk", uz: "tavakkal qilmoq", c: "Topic Vocabulary"}, {en: "score", uz: "natija ko’rsatmoq", c: "Topic Vocabulary"},
        {en: "support", uz: "qo'llab-quvatlamoq", c: "Topic Vocabulary"}, {en: "team", uz: "jamoa", c: "Topic Vocabulary"},
        {en: "train", uz: "shug'ullanmoq", c: "Topic Vocabulary"}, {en: "video game", uz: "video o'yin", c: "Topic Vocabulary"},
        {en: "carry on", uz: "davom etmoq", c: "Phrasal Verbs"}, {en: "eat out", uz: "restoranda ovqatlanmoq", c: "Phrasal Verbs"},
        {en: "give up", uz: "to'xtatmoq", c: "Phrasal Verbs"}, {en: "join in", uz: "qo'shilmoq", c: "Phrasal Verbs"},
        {en: "send off", uz: "chetlatmoq (o'yindan)", c: "Phrasal Verbs"}, {en: "take up", uz: "boshlamoq (sport/hobby)", c: "Phrasal Verbs"},
        {en: "turn down", uz: "pasaytirmoq (ovozni)", c: "Phrasal Verbs"}, {en: "turn up", uz: "ko'tarmoq (ovozni)", c: "Phrasal Verbs"},
        {en: "for a long time", uz: "ko'p vaqtdan beri", c: "Phrases"}, {en: "for fun", uz: "ko'ngilxushlik uchun", c: "Phrases"},
        {en: "in the middle (of)", uz: "...ning o'rtasida", c: "Phrases"}, {en: "in time (for)", uz: "...uchun vaqtida", c: "Phrases"},
        {en: "on CD/DVD/video", uz: "CD/DVD/videoda", c: "Phrases"}, {en: "on stage", uz: "sahnada", c: "Phrases"},
        {en: "act", uz: "harakat qilmoq", c: "Word Formation"}, {en: "action", uz: "harakat", c: "Word Formation"},
        {en: "(in)active", uz: "(no)faol", c: "Word Formation"}, {en: "actor", uz: "aktyor", c: "Word Formation"},
        {en: "athlete", uz: "atlet", c: "Word Formation"}, {en: "athletic", uz: "atletik", c: "Word Formation"},
        {en: "athletics", uz: "atletika", c: "Word Formation"}, {en: "child", uz: "bola", c: "Word Formation"},
        {en: "children", uz: "bolalar", c: "Word Formation"}, {en: "childhood", uz: "bolalik", c: "Word Formation"},
        {en: "collect", uz: "yig'moq", c: "Word Formation"}, {en: "collection", uz: "kolleksiya", c: "Word Formation"},
        {en: "collector", uz: "yig'uvchi", c: "Word Formation"}, {en: "entertain", uz: "ko'ngilxushlik qilmoq", c: "Word Formation"},
        {en: "entertainment", uz: "ko'ngilxushlik", c: "Word Formation"}, {en: "hero", uz: "qahramon", c: "Word Formation"},
        {en: "heroic", uz: "qahramonlarcha", c: "Word Formation"}, {en: "heroine", uz: "qahramon ayol", c: "Word Formation"},
        {en: "music", uz: "musiqa", c: "Word Formation"}, {en: "musical", uz: "musiqiy", c: "Word Formation"},
        {en: "musician", uz: "musiqachi", c: "Word Formation"}, {en: "play", uz: "o'ynamoq", c: "Word Formation"},
        {en: "player", uz: "o'yinchi", c: "Word Formation"}, {en: "playful", uz: "o'yinqaroq", c: "Word Formation"},
        {en: "sail", uz: "suzmoq", c: "Word Formation"}, {en: "sailing", uz: "suzish, dengiz safari", c: "Word Formation"},
        {en: "sailor", uz: "dengizchi", c: "Word Formation"}, {en: "sing", uz: "kuylamoq", c: "Word Formation"},
        {en: "sang", uz: "sing (o'tgan zamon)", c: "Word Formation"}, {en: "sung", uz: "sing (P.P. shakli)", c: "Word Formation"},
        {en: "song", uz: "kuy/qo'shiq", c: "Word Formation"}, {en: "singer", uz: "qo'shiqchi", c: "Word Formation"},
        {en: "singing", uz: "kuylash", c: "Word Formation"}, {en: "bored with", uz: "...dan zerikkan", c: "Word Patterns"},
        {en: "crazy about", uz: "...ning ashaddiy muhlisi", c: "Word Patterns"}, {en: "good at", uz: "...da yaxshi", c: "Word Patterns"},
        {en: "interested in", uz: "...ga qiziqmoq", c: "Word Patterns"}, {en: "keen on", uz: "...ga qiziqmoq", c: "Word Patterns"},
        {en: "popular with", uz: "...bilan mashhur", c: "Word Patterns"}, {en: "feel like", uz: "xohlamoq", c: "Word Patterns"},
        {en: "listen to", uz: "tinglamoq", c: "Word Patterns"}, {en: "take part in", uz: "qatnashmoq", c: "Word Patterns"},
        {en: "a book (by sb) about", uz: "...haqida kitob", c: "Word Patterns"}, {en: "a fan of", uz: "...ning muhlisi", c: "Word Patterns"},
        {en: "a game against", uz: "...ga qarshi o'yin", c: "Word Patterns"}
    ];

    let quiz = [], current = 0, score = 0, mode = '', answered = false;

    // Mobil ovozni uyg'otish
    function initSpeech() {
        const msg = new SpeechSynthesisUtterance('');
        window.speechSynthesis.speak(msg);
    }

    function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function startQuiz(m) {
        initSpeech(); // Birinchi bosishda ovozni uyg'otish
        mode = m;
        score = 0; current = 0;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'flex';
        document.getElementById('mode-label').innerText = mode === 'uz-en' ? 'Inglizchasini toping:' : 'O\'zbekchasini toping:';
        quiz = shuffle([...dictionary]);
        render();
    }

    function render() {
        answered = false;
        const item = quiz[current];
        document.getElementById('category').innerText = item.c;
        document.getElementById('counter').innerText = `${current + 1} / ${quiz.length}`;
        document.getElementById('progress').style.width = `${(current / quiz.length) * 100}%`;
        document.getElementById('q-text').innerText = mode === 'uz-en' ? item.uz : item.en;

        const optBox = document.getElementById('options');
        optBox.innerHTML = '';
        
        const correctVal = mode === 'uz-en' ? item.en : item.uz;
        let opts = [correctVal];
        while(opts.length < 4) {
            let r = dictionary[Math.floor(Math.random() * dictionary.length)];
            let v = mode === 'uz-en' ? r.en : r.uz;
            if(!opts.includes(v)) opts.push(v);
        }
        
        shuffle(opts).forEach(o => {
            const b = document.createElement('button');
            b.className = 'opt';
            b.innerText = o;
            // Mobil uchun click o'rniga touchend ishlatish ham mumkin, lekin click eng barqarori
            b.onclick = () => checkAnswer(b, o, correctVal, item.en);
            optBox.appendChild(b);
        });
        
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('btn-placeholder').style.display = 'block';
    }

    function checkAnswer(btn, selected, correct, speakWord) {
        if(answered) return;
        answered = true;
        
        const all = document.querySelectorAll('.opt');
        all.forEach(x => x.style.pointerEvents = 'none'); // Tugmalarni o'chirish
        
        // Ovoz berish
        try {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(speakWord);
            u.lang = 'en-US';
            u.rate = 0.9;
            window.speechSynthesis.speak(u);
        } catch(e) { console.log("Audio error"); }

        if(selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            all.forEach(x => { if(x.innerText === correct) x.classList.add('correct'); });
        }
        document.getElementById('score-info').innerText = `Ball: ${score}`;
        
        document.getElementById('btn-placeholder').style.display = 'none';
        document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
        current++;
        if(current < quiz.length) render();
        else showResults();
    }

    function showResults() {
        const finalTotal = answered ? current + 1 : current;
        const p = finalTotal === 0 ? 0 : Math.round((score/finalTotal)*100);
        
        document.getElementById('quiz-area').innerHTML = `
            <div class="result-box">
                <h2>Natija</h2>
                <div class="result-pct">${p}%</div>
                <p style="font-weight:700; color:#8e8e93; margin-bottom:30px;">${score} ta to'g'ri / ${finalTotal} savoldan</p>
                <button class="mode-btn" onclick="location.reload()" style="background:var(--p); color:white;">Qaytadan boshlash</button>
            </div>`;
    }
</script>
</body>
</html>