<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VocabPhone Pro</title>
    <style>
        :root { --p: #00b894; --bg: #f2f2f7; --txt: #1c1c1e; --success: #34c759; --danger: #ff3b30; --secondary: #8e8e93; }
        
        /* Telefon uchun maxsus: teginishdagi effektlarni o'chirish */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }

        .quiz-card { 
            background: white; width: 100%; max-width: 450px; padding: 20px; 
            border-radius: 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            min-height: 90vh; display: flex; flex-direction: column; 
        }

        #start-screen, .result-box { text-align: center; margin: auto 0; }
        
        .mode-btn { 
            width: 100%; padding: 20px; margin: 12px 0; border: none; 
            border-radius: 20px; background: #f1f3f5; font-size: 18px; 
            font-weight: 700; cursor: pointer; color: var(--txt);
        }
        .mode-btn:active { background: #e2e6ea; transform: scale(0.97); }

        .progress-bar { width: 100%; height: 8px; background: #e5e5ea; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        #progress { height: 100%; background: var(--p); width: 0%; transition: 0.4s cubic-bezier(0.1, 0.7, 0.1, 1); }

        .question-text { font-size: 28px; font-weight: 800; text-align: center; margin: 30px 0; color: var(--txt); min-height: 70px; display: flex; align-items: center; justify-content: center;}

        .options { display: grid; gap: 12px; }
        .opt { 
            padding: 18px; border: 2px solid #f2f2f7; border-radius: 18px; 
            background: white; font-size: 17px; font-weight: 600; cursor: pointer;
            transition: 0.2s;
        }
        
        .correct { background: var(--success) !important; color: white !important; border-color: var(--success) !important; transform: scale(1.02); }
        .wrong { background: var(--danger) !important; color: white !important; border-color: var(--danger) !important; }

        .footer { margin-top: auto; padding-top: 20px; }
        .score-info { text-align: center; font-weight: 700; color: var(--secondary); margin-bottom: 15px; font-size: 18px; }
        
        .btn-group { display: flex; gap: 10px; }
        #next-btn { flex: 2; padding: 18px; border-radius: 16px; background: var(--txt); color: white; font-weight: 700; border: none; display: none; font-size: 16px; }
        #finish-btn { flex: 1; padding: 18px; border-radius: 16px; background: #fff; color: var(--danger); border: 2px solid var(--danger); font-weight: 700; font-size: 14px; }
        
        .result-pct { font-size: 65px; font-weight: 900; color: var(--p); margin: 10px 0; }
    </style>
</head>
<body>

<div class="quiz-card">
    <div id="start-screen">
        <h1 style="font-size: 32px; margin-bottom: 5px;">English Unit 1</h1>
        <p style="color: var(--secondary); margin-bottom: 30px;">Ovozni eshitish uchun rejimni tanlang</p>
        <button class="mode-btn" onclick="startQuiz('uz-en')">O'zbekcha âž” Inglizcha ðŸ”Š</button>
        <button class="mode-btn" onclick="startQuiz('en-uz')">Inglizcha âž” O'zbekcha ðŸ”Š</button>
    </div>

    <div id="quiz-area" style="display: none; flex-direction: column; flex-grow: 1;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span id="category" style="font-size: 12px; font-weight: 800; color: var(--p); text-transform: uppercase;">...</span>
            <span id="counter" style="font-size: 14px; font-weight: 700; color: var(--secondary);">0/0</span>
        </div>
        <div class="progress-bar"><div id="progress"></div></div>
        
        <div id="q-text" class="question-text">...</div>
        <div id="options" class="options"></div>

        <div class="footer">
            <div id="score-display" class="score-info">Ball: 0</div>
            <div class="btn-group">
                <button id="finish-btn" onclick="endQuiz()">Tugatish</button>
                <button id="next-btn" onclick="nextQuestion()">Keyingisi &rarr;</button>
            </div>
        </div>
    </div>
</div>

<script>
    const dictionary = [
        {en: "beat", uz: "yutmoq, mag'lub qilmoq", c: "Vocabulary"}, {en: "board game", uz: "taxtali o'yin", c: "Vocabulary"},
        {en: "captain", uz: "kapitan", c: "Vocabulary"}, {en: "challenge", uz: "da'vat etmoq", c: "Vocabulary"},
        {en: "champion", uz: "chempion", c: "Vocabulary"}, {en: "cheat", uz: "aldamoq", c: "Vocabulary"},
        {en: "coach", uz: "murabbiy", c: "Vocabulary"}, {en: "competition", uz: "musobaqa", c: "Vocabulary"},
        {en: "concert", uz: "konsert", c: "Vocabulary"}, {en: "defeat", uz: "mag'lub qilmoq", c: "Vocabulary"},
        {en: "carry on", uz: "davom etmoq", c: "Phrasal Verbs"}, {en: "eat out", uz: "restoranda ovqatlanmoq", c: "Phrasal Verbs"},
        {en: "give up", uz: "to'xtatmoq", c: "Phrasal Verbs"}, {en: "join in", uz: "qo'shilmoq", c: "Phrasal Verbs"},
        {en: "send off", uz: "chetlatmoq (o'yindan)", c: "Phrasal Verbs"}, {en: "take up", uz: "boshlamoq", c: "Phrasal Verbs"},
        {en: "for a long time", uz: "ko'p vaqtdan beri", c: "Phrases"}, {en: "on stage", uz: "sahnada", c: "Phrases"},
        {en: "musician", uz: "musiqachi", c: "Word Formation"}, {en: "player", uz: "o'yinchi", c: "Word Formation"},
        {en: "singer", uz: "qo'shiqchi", c: "Word Formation"}, {en: "sailing", uz: "suzish", c: "Word Formation"}
        // ... Lug'atni xohlagancha davom ettirish mumkin
    ];

    let quiz = [], current = 0, score = 0, mode = '', answered = false;
    let synth = window.speechSynthesis;

    // Telefonlarda ovozni faollashtiruvchi "sehrli" funksiya
    function unlockAudio() {
        if ('speechSynthesis' in window) {
            synth.cancel(); // Navbatni tozalash
            const silent = new SpeechSynthesisUtterance(" ");
            silent.volume = 0;
            synth.speak(silent);
        }
    }

    function startQuiz(m) {
        unlockAudio(); // Tugma bosilganda ovozni uyg'otamiz
        mode = m; score = 0; current = 0;
        quiz = [...dictionary].sort(() => Math.random() - 0.5);
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'flex';
        render();
    }

    function render() {
        answered = false;
        const item = quiz[current];
        document.getElementById('category').innerText = item.c;
        document.getElementById('counter').innerText = `${current + 1}/${quiz.length}`;
        document.getElementById('progress').style.width = `${(current / quiz.length) * 100}%`;
        document.getElementById('q-text').innerText = mode === 'uz-en' ? item.uz : item.en;
        document.getElementById('score-display').innerText = `Ball: ${score}`;

        const correctVal = mode === 'uz-en' ? item.en : item.uz;
        let opts = [correctVal];
        while(opts.length < 4) {
            let r = dictionary[Math.floor(Math.random() * dictionary.length)];
            let v = mode === 'uz-en' ? r.en : r.uz;
            if(!opts.includes(v)) opts.push(v);
        }
        opts.sort(() => Math.random() - 0.5);

        const optBox = document.getElementById('options');
        optBox.innerHTML = '';
        opts.forEach(o => {
            const b = document.createElement('button');
            b.className = 'opt';
            b.innerText = o;
            b.onclick = () => check(b, o, correctVal, item.en);
            optBox.appendChild(b);
        });
        document.getElementById('next-btn').style.display = 'none';
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            synth.cancel(); // Oldingi ovozni to'xtatish
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'en-US';
            u.rate = 0.8; // Biroz sekinroq va aniqroq talaffuz
            u.pitch = 1;
            synth.speak(u);
        }
    }

    function check(btn, selected, correct, englishWord) {
        if(answered) return;
        answered = true;

        speak(englishWord); // Javob tanlanganda inglizcha so'zni o'qiydi

        if(selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            if(navigator.vibrate) navigator.vibrate(50); // Xatoda tebranish (Android)
            btn.classList.add('wrong');
            document.querySelectorAll('.opt').forEach(x => { if(x.innerText === correct) x.classList.add('correct'); });
        }
        document.getElementById('score-display').innerText = `Ball: ${score}`;
        document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
        current++;
        if(current < quiz.length) render();
        else endQuiz();
    }

    function endQuiz() {
        const total = answered ? current + 1 : current;
        const p = total === 0 ? 0 : Math.round((score/total)*100);
        document.getElementById('quiz-area').innerHTML = `
            <div class="result-box">
                <div style="font-size: 50px;">${p >= 80 ? 'ðŸŽ‰' : 'ðŸ“š'}</div>
                <div class="result-pct">${p}%</div>
                <p style="font-weight:700; color:var(--secondary);">Natija: ${score} / ${total}</p>
                <button class="mode-btn" onclick="location.reload()" style="background:var(--p); color:white;">Qayta boshlash</button>
            </div>`;
    }
</script>
</body>
</html>